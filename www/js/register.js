document.addEventListener("deviceready",onDeviceReady,!1);var username="movilesbluetooth",password="3mFh5qNR",checknameURL="http://movilesbluetooth.php.info.unlp.edu.ar/alumnos/checkname/",device_address=0;
function onDeviceReady(){currentCursoID=localStorage.getItem("currentCursoID");$("#username-progress").hide();cordovaHTTP.useBasicAuth(username,password,function(){console.log("success!");ko.applyBindings(new RegisterVM)},function(){console.log("error :(")});swal({title:"Atencion!",text:"Asegurate de tener el bluetooth encendido!",imageUrl:"img/blue.png"})}
function RegisterVM(){var a=this;a.username=ko.observable("");a.device_address=ko.observable("");a.first_name=ko.observable("");a.last_name=ko.observable("");a.password=ko.observable("");a.NroAlu=ko.observable("");navigator.connection.type==Connection.NONE&&swal({title:"Error",text:"No se puede buscar cursos sin conexion",type:"error",showCancelButton:!1,confirmButtonText:"Volver",closeOnConfirm:!1},function(){window.location="index.html"});a.registerSuccess=function(a){try{a.data=JSON.parse(a.data),
window.localStorage.setItem("user_id",a.data.id),window.localStorage.setItem("Mac",a.data.device_address),window.location="index.html"}catch(c){alert("JSON parsing error")}};a.registerFail=function(a){console.log(a)};a.submitAlumno=function(){BC.Bluetooth.OpenBluetooth(function(){window.MacAddress.getMacAddress(function(b){device_address=b;Server.RegistrarAlumno(a.first_name(),a.last_name(),a.password(),device_address.toString(),a.NroAlu(),a.username(),a.registerSuccess,a.registerFail)},function(a){alert(a)})},
function(){alert("fallo")})};a.validateName=function(){0==$("#first_name").val().length&&$("#first_name").removeClass("valid").addClass("invalid")};a.validateLastName=function(){0==$("#last_name").val().length&&$("#last_name").removeClass("valid").addClass("invalid")};a.nameChanged=function(){$("#username-progress").show();cordovaHTTP.get(checknameURL+a.username(),{},{},function(b){$("#username-progress").hide();a.getDataSuccess(JSON.parse(b.data))},function(b){$("#username-progress").hide();a.getDataFailure(b)})};
a.getDataSuccess=function(a){a.free?$("#username").removeClass("invalid").addClass("valid"):$("#username").removeClass("valid").addClass("invalid")};a.getDataFailure=function(a){console.error(a.error)}};