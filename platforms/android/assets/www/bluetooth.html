<!DOCTYPE html>
<html>
  <head>
    <title>Bluetooth</title>
	
	<link rel="stylesheet" type="text/css" href="css/index.css" />
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">
	

   
    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready",onDeviceReady,false);

    // device APIs are available
    //
    function onDeviceReady() {
		
	}
	
	//Array con datos de demo. JS no soporta arrays asociativos, solo con indices numericos.
	
	var nombres = ["Alfonso Cuitiño", "Juan Fernández", "Julia Lasarte", "Martin Couso", "Andres Pinto"];
	var direcciones	= ["00:08:CA:3E:D5:89", "90:5F:2E:BD:32:DC", ":::::", ":::::", ":::::"];

	function scanForDevices() {
		alert("besitos");
		BC.bluetooth.addEventListener("newdevice",addNewDevice);
		BC.Bluetooth.OpenBluetooth(function(){alert("todo ok!");},function(){alert("bluetooth open error!");});
		BC.Bluetooth.StartScan();//start hybrid scan,in android platform the default scan strategy is scan for BLE device 5s first, then scan for classical device 12s,and restart the hybrid scan untill the BC.Bluetooth.StopScan be called. in IOS platform only start the LE scan.
		BC.Bluetooth.StartScan(null,[]);//start hybrid scan with LE service UUID.
		BC.Bluetooth.StartScan("LE"); //just start the LE scan
		BC.Bluetooth.StartScan("Classical"); //just start the classical scan in android platform, if the platform is IOS,call this method will nothing happen.
	}
	
	function addNewDevice(s){
		var newDevice = s.target;
		var ul = document.getElementById("lista");
		var li = document.createElement("li");
		li.appendChild(document.createTextNode("Dispositivo encontrado: " + newDevice.deviceAddress + " " + newDevice.deviceName));
		ul.appendChild(li);
		
		//funcion que busca la direccion dentro del array
		for	(index = 0; index < direcciones.length; index++) {
			if ( newDevice.deviceAddress == direcciones[index] ){
				var li = document.createElement("li");
				li.appendChild(document.createTextNode(nombres[index] + " se encuentra presente! :D "));
				ul.appendChild(li);
			}
		} 
			
		var newDevice = BC.bluetooth.devices[deviceAddress];
	}
	
	
    </script>
  </head>
  <body>
	    <button onclick="scanForDevices();">Buscar dispositivos</button> <br>

	<h1>Lista de dispositivos:</h1>
	<ul id="lista">
	</ul>
  </body>
</html>
